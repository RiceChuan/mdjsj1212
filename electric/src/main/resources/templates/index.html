<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>马达加斯加电力系统</title>

    <meta name="description" content="overview &amp; stats"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="/res/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/res/ace/assets/font-awesome/4.5.0/css/font-awesome.min.css"/>

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="/res/bootstrapTable/bootstrap-table.min.css">
    <link rel="stylesheet" href="/res/layer/skin/layer.css">
    <!-- text fonts -->
    <link rel="stylesheet" href="/res/ace/assets/css/fonts.googleapis.com.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="/res/ace/assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/res/ace/assets/css/ace-part2.min.css" class="ace-main-stylesheet"/>
    <![endif]-->
    <link rel="stylesheet" href="/res/ace/assets/css/ace-skins.min.css"/>
    <link rel="stylesheet" href="/res/ace/assets/css/ace-rtl.min.css"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="/res/ace/assets/css/ace-ie.min.css"/>
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="/res/ace/assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="/res/ace/assets/js/html5shiv.min.js"></script>
    <script src="/res/ace/assets/js/res/acepond.min.js"></script>
    <![endif]-->
</head>

<body class="no-skin">
<div id="navbar" class="navbar navbar-default  ace-save-state">
    <div class="navbar-container ace-save-state" id="navbar-container">
        <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
            <span class="sr-only">Toggle sidebar</span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>
        </button>

        <div class="navbar-header pull-left">
            <a href="index.html" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    马达加斯加电力系统
                </small>
            </a>
        </div>

        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <!--<li style=" background-color: #00a2d4;display: inline"  id="denglu" >-->
                <!--<a  href="/" >-->
                <!--<span >登 &nbsp;&nbsp;录</span>-->
                <!--</a>-->
                <!--</li>-->

                <li class="light-blue dropdown-modal">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo" src="/res/ace/assets/images/avatars/user.jpg" alt="Jason's Photo"/>
                        <span class="user-info">
									<small>欢迎您:</small>
								<div th:text="${session.username}" id="username"></div>
								</span>

                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>

                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">

                        <li>
                            <a href="#">
                                当前版本：<span th:text="${session.version}" id="version"></span>
                            </a>
                        </li>
                        <li>
                            <a href="/ToMine">

                                <i class="ace-icon fa fa-user"></i>
                                个人信息
                            </a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a href="javascript:;" onclick="exit();"  id="logout">
                                <i class="ace-icon fa fa-power-off"></i>
                                退出
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div><!-- /.navbar-container -->
</div>

<div class="main-container ace-save-state" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.loadState('main-container')
        } catch (e) {
        }
    </script>

    <div id="sidebar" class="sidebar                  responsive                    ace-save-state">
        <script type="text/javascript">
            try {
                ace.settings.loadState('sidebar')
            } catch (e) {
            }
        </script>

        <ul class="nav nav-list">
            <!--<li class="">-->
            <!--<a href="#">-->
            <!--<i class="menu-icon fa fa-tachometer"></i>-->
            <!--<span class="menu-text"> 系统导航 </span>-->
            <!--</a>-->

            <!--<b class="arrow"></b>-->
            <!--</li>-->

            <li class="">
                <a href="" class="dropdown-toggle">
                    <i class="menu-icon fa fa-desktop"></i>
                    <span class="menu-text">
							  业务管理
							</span>

                    <b class="arrow fa fa-angle-down"></b>
                </a>

                <b class="arrow"></b>

                <ul class="submenu">
                    <li class="">
                        <a href="#">
                            <i class="menu-icon fa fa-caret-right"></i>

                            电量查询

                        </a>
                        <b class="arrow"></b>

                    </li>

                </ul>
            </li>
            <li class="open">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-file-o"></i>

                    <span class="menu-text">
								用户管理
							</span>

                    <b class="arrow fa fa-angle-down"></b>
                </a>

                <b class="arrow"></b>

                <ul class="submenu">
                    <li class="active">
                        <a href="/index">
                            <i class="menu-icon fa fa-caret-right"></i>
                            用户管理
                        </a>

                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-picture-o"></i>

                    <span class="menu-text">
								数据库管理
							</span>

                    <b class="arrow fa fa-angle-down"></b>
                </a>

                <b class="arrow"></b>

                <ul class="submenu">
                    <li class="">
                        <a href="#">
                            <i class="menu-icon fa fa-caret-right"></i>
                            数据库备份
                        </a>

                        <b class="arrow"></b>
                    </li>
                    <li class="">
                        <a href="#">
                            <i class="menu-icon fa fa-caret-right"></i>
                            数据库还原
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>


        </ul><!-- /.nav-list -->

        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state"
               data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>
    </div>

    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs ace-save-state" id="breadcrumbs">
                <ul class="breadcrumb">
                    <li>
                        <i class="ace-icon fa fa-home home-icon"></i>
                        <a href="/index">首页</a>
                    </li>
                </ul><!-- /.breadcrumb -->

            </div>

            <div class="page-content">
                <!--内容-->
                <!-- PAGE CONTENT BEGINS -->
                <div class="hr dotted"></div>
                <div id="div-advanced-search" >
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <form class="form-group">
                                <label for="date" class="col-sm-1 control-label">查询日期</label>
                                <div class="col-sm-2">
                                    <!--<input type="text" class="input-sm form-control" id="name"/>-->
                                    <input type="text" id="date" class="input-sm form-control">
                                    <!--<button class="btn btn-sm btn-primary" id="search">查询</button>-->
                                </div>

                                <label for="log" class="col-sm-1 control-label">查询类型</label>
                                <div class="col-sm-2">
                                    <select id="log" class="input-sm form-control">
                                        <option value="1">用户消费记录</option>
                                        <!--<option value="2">设备日志</option>-->
                                    </select>
                                </div>
                                <label for="instrument" class="col-sm-1 control-label" style="display: none" id="Choice">选择设备</label>
                                <div class="col-sm-2" style="display: none" id="Choice1">
                                    <select id="instrument" class="input-sm form-control">
                                        <option th:each="instrument:${instruments}" th:text="${instrument.getName()}" th:value="${instrument.getId()}" th:id="${instrument.getId()}" ></option><!--遍历全部设备-->

                                    </select>
                                </div>
                                <label for="user" class="col-sm-1 control-label" id="userbak">关键字查询</label>
                                <div class="col-sm-2">
                                    <input type="text" id="user" class="input-sm form-control">
                                </div>
                                <div class="col-sm-2">
                                    <div class="btn-group">
                                        <button class="btn btn-purple btn-sm" type="button" id="search">
                                            <span class="ace-icon fa fa-search icon-on-right "></span>
                                            查询
                                        </button>
                                        <button class="btn btn-info btn-sm" type="reset" id="clearopt">
                                            <span class="ace-icon fa fa-trash-o  orange"></span>
                                            重置
                                        </button>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="toolbar" class="btn-group">
                    <button id="btn_add" type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                    </button>
                    <button id="btn_edit" type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
                    </button>
                    <button id="btn_delete" type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                    </button>
                </div>
                <table id="table" data-toolbar="#toolbar">
                </table>
                <!-- PAGE CONTENT ENDS -->
            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->

    <div class="footer">
        <div class="footer-inner">
            <div class="footer-content">
						<span class="bigger-120">
							便携式测温仪后台管理
						</span>
            </div>
        </div>
    </div>

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->

<!-- basic scripts -->

<!--[if !IE]> -->
<script src="/res/ace/assets/js/jquery-2.1.4.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="/res/ace/assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='/res/ace/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="/res/ace/assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->
<script src="/res/layer/layer.js"></script>
<script src="/res/bootstrapTable/bootstrap-table.min.js"></script>
<script src="/res/bootstrapTable/bootstrap-table-zh-CN.js"></script>

<!--[if lte IE 8]>
<script src="/res/ace/assets/js/excanvas.min.js"></script>
<![endif]-->
<script src="/res/ace/assets/js/jquery-ui.custom.min.js"></script>
<script src="/res/ace/assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="/res/ace/assets/js/jquery.easypiechart.min.js"></script>
<script src="/res/ace/assets/js/jquery.sparkline.index.min.js"></script>
<script src="/res/ace/assets/js/jquery.flot.min.js"></script>
<script src="/res/ace/assets/js/jquery.flot.pie.min.js"></script>
<script src="/res/ace/assets/js/jquery.flot.resize.min.js"></script>


<!-- ace scripts -->
<script src="/res/ace/assets/js/ace-elements.min.js"></script>
<script src="/res/ace/assets/js/ace.min.js"></script>
<script src="/res/js/logout.js"></script>
<script src="/res/laydate/laydate.js"></script>



<!-- inline scripts related to this page -->

<script>
    //时间控件
    //日期时间范围
    laydate.render({
        elem: '#date'
        ,type: 'datetime'
        ,range: true
    });
</script>
<script>
    var $table = $('#table');
    var $remove = $('#btn_delete');
    var selections = [];//选中的行的id
    $table.on('check.bs.table uncheck.bs.table ' + 'check-all.bs.table uncheck-all.bs.table', function () {
        $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
        // save your data, here just save the current page
        selections = getIdSelections();
        // push or splice the selections if you want to save all data selections
    });
    //获取行id
    function getIdSelections() {
        return $.map($table.bootstrapTable('getSelections'), function (row) {
            return row.id
        });
    }
    $('#btn_edit').click(function () {
        var l = selections.length;
        if (l == 0 || l > 1) {
            layer.alert("请先选择一条记录!", {icon: 2})
        } else {
            console.log(selections[0])
        }
    });
    $('#btn_delete').click(function () {
        var l = selections.length;
        if (l == 0 || l > 1) {
            layer.alert("请先选择一条记录!", {icon: 2})
        } else {
            console.log(selections[0])
        }
    });
    //下拉框change事件
    $('#log').on('change',
        function () {
            var test =$("#log").val();
            if(test==2){
                $("#userbak").css({"display":"none"});
                $("#user").css({"display":"none"});
                $("#Choice").css({"display":"inline"});
                $("#Choice1").css({"display":"inline"});
            }
            if(test==1){
                $("#userbak").css({"display":"inline"});
                $("#user").css({"display":"inline"});
                $("#Choice").css({"display":"none"});
                $("#Choice1").css({"display":"none"});
            }
        });
    //重置日期,destroy销毁表格
    $('#clearopt').click(function () {
        $("#Choice").css({"display":"none"});
        $("#Choice1").css({"display":"none"});
        $("#userbak").css({"display":"inline"});
        $("#user").css({"display":"inline"});
        $('#table').bootstrapTable('destroy');

    })
    //查询
    $("#search").click(function search(){
        $table.bootstrapTable('refresh');       //刷新列表
        initTable();
        })
        $table.bootstrapTable('refresh');       //刷新列表
        initTable();
        function initTable() {
            $table.bootstrapTable({
                url: '/searchLogger',
//                ajaxOptions:{
//                    headers: { "authorization":local.sessionId}
//                },
                toolbar: '#toolbar',
                cache : false,
//             headers:{
//                 "authorization":local.sessionId
//             },
//             type:'get',
//             data:{"date":val},
                columns: [{
                    field: 'state',
                    checkbox: true
                },{
                    field: 'username',
                    align: 'center',
                    title: '用户名'
                }, {
                    field: 'power_account',
                    align: 'center',
                    title: '累计用电量'
                }, {
                    field: 'power_remain',
                    align: 'center',
                    title: '剩余电量'
                }, {
                    field: 'total_consumption',
                    align: 'center',
                    title: '总计消费'
                }, {
                    field: 'consumption_balance',
                    align: 'center',
                    title: '账户余额',
                    formatter: formatter1
                }, {
                    field: 'create_time',
                    align: 'center',
                    title: '账号注册时间'
                }, {
                    field: 'pay_method',
                    align: 'center',
                    title: '支付方式',
                    formatter: formatter
                }, {
                    field: 'id',
                    align: 'center',
                    title: '查询用电情况',
                    formatter:search
                }],
                silent: true,
                showToggle: true,
                showRefresh: true,
                height: 650,
                pagination: true,
                pageSize: 10,
                pageList: [10, 20],
                dataType: "json",
                search: false,
//                queryParams: queryParams,
                sidePagination: "server"
            })

            function formatter(value) {
                if (value == 1) {
                    return '<span style="color:red">银行支付</span>';
                } else {
                    return '手机余额';
                }
            }
            function formatter1(value) {
                if (value == 0) {
                    return '<span style="color:red">0</span>';
                } else {
                    return value;
                }
            }
            //查询参数
            function queryParams(params){
                var val = $("#log").val();
                var username = $("#user").val();
                var date = $("#date").val();//时间字符串
                if(date==null||date==''){
                    date="1970-01-22 00:00:00 - 1970-01-23 00:00:00";
                }
                var instrument = "";
                if(val==1){
                    instrument="";
                } else{
                    instrument=$("#instrument option:selected").val();  //获取选中的项
                }
                var temp = {
                    username:username,
                    instrument:instrument,
                    date:date,
                    limit: params.limit,
                    offset: params.offset
                }
                return temp;
            }
        }
        function search(value){
            console.log(value);
                var e = '<a href="/?id='+value+'">查询</a> ';
                return e;
        }

</script>
</body>
</html>
